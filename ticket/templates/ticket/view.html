{% extends "ticket/layout.html" %} {% block content %} {% load staticfiles i18n %} {% load humanize %}

<div class="row">
    <div class="col-md-12">

        <div class="action-bar clearfix">
            <div class="pull-left">
                <button type="button" onclick="window.history.back()" class="btn btn-default"><i class="fa fa-chevron-left" aria-hidden="true"></i> Back</button>
                <button class="btn btn-default">Workflow</button>
                <button class="btn btn-default">Attachment</button>
            </div>
            <div class="pull-right">
                {% for action in actions %}
                <a href="/tickets/view/{{ ticket.slug }}/action/{{ action.slug }}" class="btn answer-container">{{ action.name }}</a> {% endfor %}
            </div>
        </div>

        <div class="row">
            <div class="col-md-8">
                <div class="panel panel-primary">
                    <div class="panel-heading"><h3 class="panel-title">{{ ticket.created_by.username }} says:</h3></div>
                    <div class="panel-body">
                        <div class="media">
                            <div class="media-left">
                                <a href="#">
                                    <img class="media-object" data-src="holder.js/64x64" alt="64x64" src="{% static "ticket/avatars/avatar4.png" %}" data-holder-rendered="true" style="width: 48px; height: 48px;">
                                </a>
                            </div>
                            <div class="media-body">{{ ticket.description }}</div>
                        </div>
                    </div>
                </div>
                <div class="comments-container">
                    {% for c in comments %}
                    <div class="panel panel-default">
                        <div class="panel-heading"><h3 class="panel-title">{{ c.user.username }} says {{ c.created|naturaltime }}</h3></div>
                        <div class="panel-body">
                            <div class="media">
                                <div class="media-left">
                                    <a href="#">
                                        <img class="media-object" data-src="holder.js/64x64" alt="64x64" src="{% static "ticket/avatars/avatar4.png" %}" data-holder-rendered="true" style="width: 48px; height: 48px;">
                                    </a>
                                </div>
                                <div class="media-body">{{ c.comment }}</div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                <hr>
                <div class="container-reply">

                    <form method="POST" action="/tickets/view/{{ ticket.slug }}/comment">

                        {% csrf_token %}
                        {{ commentForm.ticket }}
                        {{ commentForm.user }}

                        <div class="panel panel-default">

                            <div class="panel-body" style="padding: 0px;">
                                <textarea name="comment" class="summernote"></textarea>
                            </div>

                            <div class="panel-footer">

                                <div class="panel-body demo-panel-files" id='demo-files'></div>

                                <div class="clearfix">

                                    <button style="float:left" class="btn btn-primary">Reply</button>
                                    
                                    <div id="drag-and-drop-zone" class="uploader">
                                        <div class="browser">
                                            <label class="btn btn-default">
                                                <span>ADD FILE</span>
                                                <input type="file" name="files[]" multiple="multiple" title='Click to add Files'>
                                            </label>
                                        </div>
                                    </div>
                                    
                                </div>

                            </div>
                        </div>

                    </form>
                </div>
            </div>
            <div class="col-md-4">
                <table class="table table-condensed">
                    <tr>
                        <th>Status</th>
                    </tr>
                    <tr>
                        <td><span class="label-block label label-{{ ticket.status.label_class }}">{{ ticket.status.name }}</span></td>
                    </tr>
                    <tr>
                        <th>Created</th>
                    </tr>
                    <tr>
                        <td>{{ ticket.created|naturaltime }}</td>
                    </tr>
                    <tr>
                        <th>Assigned To</th>
                    </tr>
                    <tr>
                        <td>{{ ticket.assigned_to.username }}</td>
                    </tr>
                </table>
                <hr>
                <div class="container-attachment">
                    <ul>
                        <li><a href="#">attachment_a.pdf</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">


$(document).ready(function() {

    $('.summernote').summernote({
        height: 150
    });

    var plugin = $('#drag-and-drop-zone').dmUploader({
        url: '/tickets/upload/',
        dataType: 'json',
        allowedTypes: 'image/*',
        /*extFilter: 'jpg;png;gif',*/
        onInit: function(){
            console.log('#demo-debug', 'default', 'Plugin initialized correctly');
        },
        onBeforeUpload: function(id){
        },
        onNewFile: function(id, file){
            $.danidemo.addFile('#demo-files', id, file);
        },
        onComplete: function(){
            console.log('on complete');
            console.log($(this));
        },
        onUploadProgress: function(id, percent){
          var percentStr = percent + '%';
          $.danidemo.updateFileProgress(id, percentStr);
        },
        onUploadSuccess: function(id, data){
            console.log(this);
        },
        onUploadError: function(id, message){
          $.danidemo.updateFileStatus(id, 'error', message);
        },
        onFileTypeError: function(file){
          console.log('#demo-debug', 'error', 'File \'' + file.name + '\' cannot be added: must be an image');
        },
        onFileSizeError: function(file){
          console.log('#demo-debug', 'error', 'File \'' + file.name + '\' cannot be added: size excess limit');
        },
        onFallbackMode: function(message){
          console.log('#demo-debug', 'info', 'Browser not supported(do something else here!): ' + message);
        }
      });

});
</script>
{% endblock %}
